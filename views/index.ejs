<!DOCTYPE html>
<html>
  <head>
    <title><%= title %></title>
    <link rel='stylesheet' href='/stylesheets/style.css' />
  </head>
  <body>
    <h1><%= title %></h1>
    <p>Welcome to <%= title %></p>

    <form name="contacts" action="/" method="post">
        <input type ='text' name="username" placeholder="Name"/>
        <input type="email"  name="email" placeholder="Email"/>
        <input type="submit" name ="button" value="Post data"/>
        <button name="get">Get All</button>
    </form>
    <div>


    </div>
    <form name="update" action="/" method="post">
        <input type ='text' name="username" placeholder="Name"/>
        <input type="email"  name="email" placeholder="Email"/>
        <input type="submit" name ="button" value="Search"/>
    </form>

  <script>
      function ContactService(){

      };

      ContactService.prototype.create = function(object){
          //console.log('Create fired!');
          makeAjaxCall('/contacts', 'POST', object, done);

      };

      ContactService.prototype.get = function(id){
          //get id

      };

      ContactService.prototype.getAll = function(){
          makeAjaxCall('/contacts', 'GET', null, done);
      };

      ContactService.prototype.update = function(id, object){

      };

      ContactService.prototype.delete = function(id){

      };

      function done(){
          console.log("Done..");
      }

      function makeAjaxCall(url, HttpVerb, Object, callback){
          var xhr = new XMLHttpRequest();
          xhr.open(HttpVerb, url); //get or post or any other verb
          // if the httpVerb is post, modify the request header - content-type, xhr.send(JSON.stringify(obj))

          if(HttpVerb == 'POST' && typeof Object != null){
              //set the request header
              xhr.setRequestHeader('content-type', 'application/json');
          }
            xhr.addEventListener('readystatechange',function(){
                if(xhr.readyState === 4){
                    callback(xhr);
                }
            });
          if(HttpVerb == 'POST')  xhr.send(JSON.stringify(Object));
          if(HttpVerb == 'GET') xhr.send();
      }

      document.addEventListener('DOMContentLoaded',function(){

          var forms  = document.forms.contacts;
          forms.addEventListener('click', function(event){
             //prevent default on event
              event.preventDefault();
          });

          var button = forms.button;
          button.addEventListener('click', function(){
              //console.log('Button click');
              var usernameIn = forms.username.value;
              var emailIn = forms.email.value;

              //for create //use the same param name as the one in contact model
              var contactObject = {name : usernameIn, email: emailIn};
              var cs = new ContactService();
              cs.create(contactObject);

          });
          var getButton = document.querySelector('button');
          getButton.addEventListener('click',function(){
              var cs = new ContactService();
              cs.getAll();
          });
          //for get single id
          var updateForm = document.forms.update;
          updateForm.addEventListener('click', function(event){
              //prevent default on event
              event.preventDefault();
          });
          var updateButton = document.forms.search.button;
          //console.log(searchButton);

      });
  </script>
  </body>
</html>
